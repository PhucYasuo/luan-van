<!DOCTYPE html>
<html lang="vi">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Giáo viên</title>
	<style>
		/* Reset cơ bản */
		* {
		margin: 0;
		padding: 0;
		box-sizing: border-box;
		font-family: Arial, sans-serif;
		}

		/* Table container */
		.table-container {
		max-width: 1200px;
		margin: 30px auto;
		padding: 0 15px;
		}

		/* Table */
		table {
		width: 100%;
		border-collapse: collapse;
		background-color: #fff;
		box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
		}
		th, td {
		border: 1px solid #e0e0e0;
		padding: 12px 15px;
		text-align: left;
		}
		th {
		background-color: #f5f5f5;
		font-weight: 600;
		color: #333;
		text-transform: uppercase;
		font-size: 14px;
		}
		td {
		color: #555;
		font-size: 14px;
		}
		tr:nth-child(even) {
		background-color: #fafafa;
		}
		tr:hover {
		background-color: #f0f0f0;
		}

		/* Buttons and links */
		button, a {
		display: inline-block;
		padding: 8px 16px;
		text-decoration: none;
		color: white;
		background-color: #007bff;
		border-radius: 4px;
		border: none;
		cursor: pointer;
		font-size: 14px;
		transition: background-color 0.3s, transform 0.1s;
		}
		button:hover, a:hover {
		background-color: #0056b3;
		transform: translateY(-1px);
		}
		a[href*="/delete"] {
		background-color: #dc3545;
		}
		a[href*="/delete"]:hover {
		background-color: #b02a37;
		}
		.add-btn {
		background-color: #28a745;
		margin-bottom: 20px;
		padding: 10px 20px;
		}
		.add-btn a {
		color: white;
		text-decoration: none;
		}
		.add-btn:hover {
		background-color: #218838;
		}

		/* Modal */
		.modal {
		display: none;
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background-color: rgba(0, 0, 0, 0.6);
		justify-content: center;
		align-items: center;
		z-index: 1000;
		opacity: 0;
		transition: opacity 0.3s ease;
		}
		.modal.show {
		opacity: 1;
		}
		.modal-content {
		background-color: #fff;
		padding: 20px;
		border-radius: 8px;
		width: 100%;
		max-width: 500px;
		box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
		transform: translateY(-50px);
		transition: transform 0.3s ease;
		}
		.modal.show .modal-content {
		transform: translateY(0);
		}
		.modal-content h2 {
		margin: 0 0 20px;
		font-size: 20px;
		color: #333;
		}
		.modal-content label {
		display: block;
		margin-bottom: 5px;
		font-weight: 500;
		color: #444;
		}
		.modal-content input,
		.modal-content select {
		width: 100%;
		padding: 10px;
		margin-bottom: 15px;
		border: 1px solid #ccc;
		border-radius: 4px;
		font-size: 14px;
		transition: border-color 0.3s;
		}
		.modal-content input:focus,
		.modal-content select:focus {
		border-color: #007bff;
		outline: none;
		}
		.modal-content input[readonly] {
		background-color: #f8f8f8;
		cursor: not-allowed;
		}
		.modal-content button {
		padding: 10px 20px;
		border: none;
		border-radius: 4px;
		cursor: pointer;
		font-size: 14px;
		transition: background-color 0.3s;
		}
		.modal-content button[type="submit"] {
		background-color: #007bff;
		color: white;
		}
		.modal-content button[type="submit"]:hover {
		background-color: #0056b3;
		}
		.modal-content button[type="button"] {
		background-color: #6c757d;
		color: white;
		}
		.modal-content button[type="button"]:hover {
		background-color: #5a6268;
		}
		.close-btn {
		float: right;
		cursor: pointer;
		font-size: 24px;
		color: #555;
		transition: color 0.3s;
		}
		.close-btn:hover {
		color: #000;
		}

		/* Responsive */
		@media (max-width: 768px) {
		.table-container {
			padding: 0 10px;
		}
		table {
			font-size: 12px;
		}
		th, td {
			padding: 8px;
		}
		.modal-content {
			width: 90%;
			padding: 15px;
		}
		}
	</style>
</head>
<body>
	<%- include('../navbar') %>
	<div class="table-container">
		<h2>Danh sách Giáo Viên</h2>
		<button class="add-btn" onclick="openModalCreate()"></button>
		<table border="1">
		<thead>
			<tr>
			<th>Mã</th>
			<th>Tên</th>
			<th>Ngày sinh</th>
			<th>Giới tính</th>
			<th>SĐT</th>
			<th>Mail</th>
			<th>Địa chỉ</th>
			<th>Tổ bộ môn</th>
			<th>Hành động</th>
			</tr>
		</thead>
		<tbody id="tableBody">
			<% giaoviens.forEach(giaovien => { %>
			<tr>
				<td><%= giaovien.GV_Ma %></td>
				<td><%= giaovien.GV_HoTen %></td>
				<td><%= giaovien.GV_NgaySinh %></td>
				<td><%= giaovien.GV_GioiTinh %></td>
				<td><%= giaovien.GV_SoDT %></td>
				<td><%= giaovien.GV_Mail %></td>
				<td><%= giaovien.GV_DiaChi %></td>
				<td><%= giaovien.TBM_Ma %></td>
				<td>
				<button onclick="openModalEdit('<%= giaovien.GV_Ma %>', '<%= giaovien.GV_HoTen %>', '<%= giaovien.GV_NgaySinh %>', '<%= giaovien.GV_GioiTinh %>', '<%= giaovien.GV_SoDT %>', '<%= giaovien.GV_Mail %>', '<%= giaovien.GV_DiaChi %>', '<%= giaovien.TBM_Ma %>')">Edit</button>
				<a href="/giao-vien/delete/<%= giaovien.GV_Ma %>" onclick="return confirm('Are you sure you want to delete this teacher?')">Delete</a>
				</td>
			</tr>
			<% }) %>
		</tbody>
		</table>
	</div>

	<div id="pop-up-modal" class="modal">
		<div class="modal-content">
		<span class="close-btn" onclick="closeModal()">×</span>
		<h2>Chỉnh sửa giáo viên</h2>
		<form id="pop-up-form">
			<input type="hidden" name="_method" value="PUT">
			<label for="ma">Mã giáo viên:</label>
			<input type="text" id="ma" name="GV_Ma" readonly>
			<label for="ten">Tên giáo viên:</label>
			<input type="text" id="ten" name="GV_HoTen" required>
			<label for="ngaysinh">Ngày sinh:</label>
			<input type="date" id="ngaysinh" name="GV_NgaySinh" required>
			<label for="gioitinh">Giới tính:</label>
			<select id="gioitinh" name="GV_GioiTinh" required>
			<option value="Nam">Nam</option>
			<option value="Nữ">Nữ</option>
			<option value="Khác">Khác</option>
			</select>
			<label for="sdt">SĐT:</label>
			<input type="text" id="sdt" name="GV_SoDT" required>
			<label for="mail">Mail:</label>
			<input type="email" id="mail" name="GV_Mail" required>
			<label for="diachi">Địa chỉ:</label>
			<input type="text" id="diachi" name="GV_DiaChi" required>
			<label for="tbm">Tổ bộ môn:</label>
			<select id="tbm" name="TBM_Ma">
				<% tobomons.forEach(tobomon => { %>
					<option value="<%= tobomon.TBM_Ma %>"><%= tobomon.TBM_Ten %></option>
				<% }) %>
			<button id="submitBtn" type="submit">Lưu</button>
			<button type="button" onclick="closeModal()">Hủy</button>
		</form>
		</div>
	</div>



	<script>
		function openModalEdit(ma, ten, ngaysinh, gioitinh, soDT, mail, diachi, tbm) {
			const modal = document.getElementById('pop-up-modal');
			const form = document.getElementById('pop-up-form');
			const submitBtn = document.getElementById('submitBtn');
			submitBtn.onclick = async (event) => {
				event.preventDefault();
				await submitEditForm(form);
			};
			
			if (!modal || !form) {
				console.error('Modal or form not found');
				return;
			}
			form.action = `/giao-vien/edit/${ma}`;
			form.method = 'PUT';
			form.querySelector('#ma').value = ma;
			form.querySelector('#ten').value = ten;
			form.querySelector('#ngaysinh').value = ngaysinh;
			form.querySelector('#gioitinh').value = gioitinh;
			form.querySelector('#sdt').value = soDT;
			form.querySelector('#mail').value = mail;
			form.querySelector('#diachi').value = diachi;
			form.querySelector('#tbm').value = tbm;
			modal.style.display = 'flex';
			modal.classList.add('show');
		}

		async function submitEditForm(form) {
			if (!form) {
				console.error('Form not found');
				return;
			}

			const formData = new FormData(form);
			const data = Object.fromEntries(formData);
			
			try {
				const response = await fetch(form.action, {
					method: 'PUT',
					headers: {
						'Content-Type': 'application/json'
					},
					body: JSON.stringify(data)
				});

				if (!response.ok) {
					throw new Error('Lỗi khi cập nhật');
				}

				const result = await response.json();
				alert('Cập nhật thành công!');
				closeModal();
			} catch (error) {
				console.error('Error:', error);
				alert('Đã có lỗi xảy ra!');
			}
		}

		

		function closeModal() {
		const modal = document.getElementById('pop-up-modal');
		if (modal) {
			modal.classList.remove('show');
			setTimeout(() => {
			modal.style.display = 'none';
			}, 300); // Chờ animation hoàn thành
		}
		}

		document.getElementById('pop-up-modal').onclick = function(event) {
			if (event.target === this) {
				closeModal();
			}
		};

		document.getElementById('pop-up-form').addEventListener('submit', function(event) {
			const ten = document.getElementById('ten').value;
			const ngaysinh = document.getElementById('ngaysinh').value;
			const gioitinh = document.getElementById('gioitinh').value;
			const sdt = document.getElementById('sdt').value;
			const mail = document.getElementById('mail').value;
			const diachi = document.getElementById('diachi').value;
			if (!ten || !ngaysinh || !gioitinh || !sdt || !mail || !diachi) {
				alert('Vui lòng điền đầy đủ thông tin!');
				event.preventDefault();
				return;
			}
			if (!/^\S+@\S+\.\S+$/.test(mail)) {
				alert('Email không hợp lệ!');
				event.preventDefault();
				return;
			}
			if (!/^\d{10}$/.test(sdt)) {
				alert('SĐT phải là 10 chữ số!');
				event.preventDefault();
				return;
			}
		});
	</script>
</body>
</html>